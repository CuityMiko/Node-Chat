<!doctype html>
<html>
	<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="description" content="A chat project." />
	<meta name="keywords" content="Project" />
	<meta name="author" content="Niko H. (Sehrentos)" />
	<meta name="robots" content="noindex, nofollow" />
	<link rel="shortcut icon" href="icon32.ico" sizes="32x32" type="image/x-icon" />
	<link rel="icon" href="favicon64.ico" sizes="64x64" type="image/x-icon" />
	<title>Chat</title>
	<!-- Stylesheet -->
	<link href="css/styles.css" rel="stylesheet" />
	<link href="css/plugins.css" rel="stylesheet" />
	<!-- Javascript libraries -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
	<!-- Javascripts -->
	<script src="js/plugins.js" charset="utf-8"></script>
	<script src="js/scripts.js" charset="utf-8"></script>
<script>
if ("jQuery" in window) {

	// Define a method that allows fetching a cached script
	jQuery.cachedScript = function( url, options ) {

		// Allow user to set any option except for dataType, cache, and url
		options = $.extend( options || {}, {
			dataType: "script",
			cache: true,
			url: url
		});

		// Use $.ajax() since it is more flexible than $.getScript
		// Return the jqXHR object so we can chain callbacks
		return jQuery.ajax( options );
	};
	// Load default scripts and execute it
	//$.cachedScript( "js/scripts.js" ).done(function( script, textStatus ) {
	//	console.log( textStatus );
	//});

	$(function() {
		// Prevent submit while chat has not been initialized
		$("form").submit(function(e) {
			e.preventDefault();
			return;
		});

		// Open WebSocket.
		if ("WebSocket" in window) {
			// Ask user to connect server
			//chat.connect(function(){ /*Do your stuff...*/ });
			// Or like this:
			$.fn.nConfirm({
				title: "Welcome to Chat",
				message: "Do you wish to <b>connect</b> to the server?",
				enableBackground: true,
				onSubmit: function() {
					// Initialize
					chat.init();

					// Check that socket has been initialized
					if (typeof chat.socket !== 'undefined') {
						// Focus input/textarea.
						chat.setFocus();

						// Set main menu
						chat.drawMenu();

						// Set default volume level: 0.1 - 1.0
						chat.playVolume( 0.5 );

						/*
						// Volume slider: 0.1 - 1.0
						$("#volume-slider").change(function(){
							chat.playVolume( this.value / 100);
							this.title = "Volume: "+ this.value +"%";
							chat.playAudio();
						});
						*/

						// Define submit event
						$("form").submit(function(e) {
							e.preventDefault();
							var whisper = $(this).parent().find("#whisper"),
								message = $(this).parent().find("#message");
							if (whisper.val().length) {
								chat.setWhisper( whisper.val(), message.val() );
								message.val('');
							} else {
								chat.setSubmit( message );
							}
						});

						// Define textarea keydown event
						$("#message").keydown(function(e) {
							if (e.keyCode == 13 && !e.shiftKey) {
								e.preventDefault();
								var whisper = $(this).parent().find("#whisper"),
								message = $(this).parent().find("#message");
								if (whisper.val().length) {
									chat.setWhisper( whisper.val(), message.val() );
									message.val('');
								} else {
									chat.setSubmit( message );
								}
							}
						});
					}
				}
			});
		} else {
			chat.mes("WebSocket is not supported by your browser!");
		}

	});

}
</script>
	</head>
	<body>
		<div id="wrap">
			<table>
				<tr>
					<td colspan="2">
						<div id="header">
							<div id="welcome">Not connected.</div>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div id="content">
							<ul id="messages"></ul>
						</div>
					</td>
					<td>
						<div id="users">
							<ul>
								<li class="user">&rsaquo; No users</li>
							</ul>
						</div>
					</td>
				</tr>
				<tr>
					<td colspan="2">
						<div id="footer">
							<form action="" id="sendform">
								<input type="text" id="whisper" class="border" placeholder="Whisper" />
								<!-- <input type="text" id="message" class="border" placeholder="Write message..." autocomplete="off" /> -->
								<textarea id="message" class="border" placeholder="Write message..." autocomplete="off" rows="1"></textarea>
								<input type="submit" id="send" class="border" value="Send" />
							</form>
						</div>
					</td>
				</tr>

			</table>
			<div class="hidden">
				<!-- Audio source: eng.universal-soundbank.com/hits.htm -->
				<audio id="audio" controls hidden>
					<source src="sound/anvil.mp3" type="audio/mpeg">
					<source src="sound/anvil.ogg" type="audio/ogg">
					<embed src="sound/anvil.mp3">
					Your browser does not support HTML5 audio.
				</audio>
			</div>
		</div>
	</body>
</html>